Response:
My thought process for summarizing the functionality of `fs_agent.js` based on the provided code snippets goes like this:

1. **Identify the Core File:** The prompt explicitly states the file is `frida/build/subprojects/frida-tools/agents/fs/fs_agent.js`. This immediately tells me the file is likely related to file system operations within the Frida instrumentation framework. The "agent" part suggests it runs *inside* the target process being instrumented.

2. **Scan for Obvious Clues (Imports and Exports):**  I look for `import` and `export` statements in the code snippets. This provides hints about what the file depends on and what it provides to other modules. I see imports related to:
    * `"util"` (likely for formatting or utility functions)
    * `"../errors.js"` (handling custom error types)
    * `"./event_target.js"` (event handling mechanisms)
    * `"./abort_controller.js"` (managing asynchronous operation cancellation)
    * `"./end-of-stream.js"` (managing stream completion)
    * `"./pipeline.js"` (for composing streams)
    * `"./utils.js"` (utility functions related to streams)
    * `"./from.js"` and `"./readable.js"` (creating readable streams)
    * `"./writable.js"` (creating writable streams)
    * `"./duplex.js"` (creating duplex streams)
    * `"./destroy.js"` (managing the destruction of streams)
    * `"buffer"` (for working with binary data)

3. **Analyze Key Data Structures and Functions:** I look for the main classes, functions, and data structures defined within the file. The provided snippets show definitions for:
    * `AbortSignal` and `AbortController`:  These are standard web API concepts for managing cancellation of asynchronous operations. Their presence indicates the agent likely deals with operations that can be cancelled.
    * `BufferList`: This suggests efficient handling of potentially large amounts of data, common in file system operations.
    * `ComposeDuplex`: A custom duplex stream implementation, suggesting the agent can handle both reading and writing in a combined stream.
    *  Various error-related constants (e.g., `ERR_INVALID_ARG_TYPE`). This is common in robust libraries.

4. **Infer Functionality Based on Names and Patterns:** I try to deduce what the code *does* by examining the names of classes, functions, and variables.
    * Functions like `addAbortSignal` strongly suggest the ability to associate cancellation signals with streams.
    *  The presence of stream-related classes (Readable, Writable, Duplex) points to the agent interacting with file system objects as streams of data.
    * The `fs` in the directory name is a strong indicator of file system interaction.

5. **Connect the Dots:** I start to synthesize the individual pieces of information into a coherent understanding of the agent's functionality. The agent likely:
    * Intercepts or monitors file system calls.
    * Represents file system objects (files, directories) as streams.
    * Provides mechanisms to control (abort) ongoing file system operations.
    * Handles data transfer efficiently using `BufferList`.
    * Uses standard Node.js stream concepts.

6. **Address Specific Instructions:**  The prompt asks about:
    * **Binary/Kernel/Linux:** While the code deals with buffers (binary data), there's no *direct* indication of low-level kernel interaction *within these snippets*. The Frida framework itself handles the low-level interception. The agent likely operates at a higher level, using Frida's capabilities.
    * **LLDB/Python:** Since the code *is* the debugging mechanism (it's an instrumentation agent), directly replicating its *entire* functionality with LLDB would be complex and miss the point. Instead, LLDB could be used to *examine* the agent's behavior within the target process. I need to suggest how to use LLDB to observe variables or function calls *within* the agent.
    * **Logic/Assumptions:** The primary assumption is that the directory structure (`frida/build/subprojects/frida-tools/agents/fs/`) is indicative of the agent's purpose. The input would be file system operations in the target process; the output would be the agent's actions (logging, modification, etc.).
    * **User Errors:**  Incorrect usage of the agent's API (if it exposes one) or issues with Frida setup are possible user errors.
    * **User Steps:**  A user would need to set up Frida, write a Frida script that uses this `fs_agent`, and then run the script against a target process performing file system operations.

7. **Structure the Summary:** I organize the information into logical sections, addressing each point of the prompt clearly and concisely. I start with a high-level summary and then elaborate on specific aspects. I also incorporate the requested examples (even if they are illustrative rather than direct replications).

8. **Refine and Review:** I read through the summary to ensure accuracy, clarity, and completeness. I check that I've addressed all parts of the prompt and that the language is understandable. I make sure to note the limitations of only having code snippets and that the full context might reveal more details.

By following these steps, I can arrive at a comprehensive and informative summary of the `fs_agent.js` file's functionality based on the provided code.这是一个名为 `fs_agent.js` 的 Frida 动态 instrumentation tool的源代码文件，它位于 `frida/build/subprojects/frida-tools/agents/fs/` 目录下。根据提供的代码片段，我们可以归纳一下它的功能：

**核心功能：文件系统操作的监控和控制**

`fs_agent.js` 作为一个 Frida agent，其主要功能是**监控和可能控制目标进程的文件系统操作**。它通过 Frida 提供的 API 插入到目标进程中，拦截和分析与文件系统相关的操作。

**具体功能点 (基于代码推断):**

1. **错误处理和聚合:**
   -  定义了一系列与文件系统操作相关的错误代码（例如 `ERR_ILLEGAL_CONSTRUCTOR`, `ERR_INVALID_ARG_TYPE` 等），这些错误代码可能用于在监控或控制文件系统操作时报告错误。
   -  提供了 `aggregateTwoErrors` 函数，用于合并两个错误对象，这在处理可能同时发生的多个错误时很有用。

2. **异步操作控制 (AbortController/AbortSignal):**
   - 实现了 `AbortController` 和 `AbortSignal` 接口，这表明 `fs_agent.js` 能够处理可以被取消的异步文件系统操作。
   -  这允许在操作进行过程中取消它们，例如，取消一个正在进行的读取或写入操作。

3. **数据流处理 (Streams):**
   - 代码中大量使用了 Node.js 的 Stream 相关概念（Readable, Writable, Duplex, pipeline）。这暗示 `fs_agent.js` 将文件系统中的文件和操作抽象为数据流进行处理。
   -  例如，读取文件可能被表示为一个 Readable Stream，写入文件可能被表示为一个 Writable Stream。
   -  `BufferList` 类用于高效地管理和操作数据块，这在处理文件数据时非常重要。
   -  `compose` 函数用于组合多个 Stream，形成复杂的数据处理管道。

4. **事件处理 (EventTarget):**
   - 实现了 `EventTarget` 接口，这表明 `fs_agent.js` 使用事件机制来通知文件系统操作的状态变化，例如操作完成、发生错误等。

5. **资源销毁和清理:**
   -  提供了 `destroy` 和 `destroyer` 函数，用于安全地销毁和清理与文件系统操作相关的资源，防止资源泄漏。

**二进制底层和 Linux 内核的关联 (推测):**

虽然代码本身是 JavaScript，运行在 Frida 的 JavaScript 引擎中，但其背后的功能必然涉及到与目标进程底层的文件系统交互。Frida 框架本身负责将 JavaScript 代码中的操作转换为对目标进程的底层调用。

- **二进制底层:**  当 `fs_agent.js` 需要读取或写入文件时，最终会操作二进制数据。`BufferList` 的使用就体现了对二进制数据的处理。
- **Linux 内核:** 在 Linux 系统上，文件系统的操作最终会通过系统调用与内核交互。Frida 框架会拦截目标进程的这些系统调用，并允许 `fs_agent.js` 进行监控或修改。

**举例说明 (推测):**

假设目标进程尝试打开一个文件进行读取：

1. **Frida 拦截:** Frida 框架拦截到目标进程的 `open()` 系统调用。
2. **Agent 介入:**  `fs_agent.js` 通过 Frida 提供的 API 获得这次调用的信息，例如打开的文件路径、打开模式等。
3. **监控/控制:** `fs_agent.js` 可以记录这次打开操作，或者根据预设的规则阻止这次操作，甚至修改打开的文件路径。
4. **数据流处理:** 如果允许打开操作，`fs_agent.js` 可能会将这个文件抽象为一个 Readable Stream，后续的 `read()` 操作也会被拦截，数据可以通过 `BufferList` 进行处理。

**lldb 指令或 Python 脚本复刻 (如果源代码是调试功能的实现):**

由于 `fs_agent.js` 本身就是一个用于动态 instrumentation 和监控的工具，直接用 lldb 复刻其 *全部* 功能是不现实的。但是，我们可以使用 lldb 或 Frida 的 Python API 来观察 `fs_agent.js` 在目标进程中的行为。

**lldb 示例 (观察 `fs_agent.js` 的变量):**

假设我们想观察 `fs_agent.js` 中 `AbortController` 的状态。

1. **找到目标进程:** 使用 lldb attach 到目标进程。
2. **查找 agent 加载的 JavaScript 上下文:** 这通常比较复杂，需要一些 Frida 的内部知识。
3. **在 JavaScript 上下文中查找对象:**  一旦找到上下文，可以使用 JavaScriptCore 的 lldb 命令来检查 JavaScript 对象。例如，如果知道 `AbortController` 的实例名称，可以尝试打印其属性。

**Frida Python 脚本示例 (与 `fs_agent.js` 交互):**

```python
import frida
import sys

def on_message(message, data):
    if message['type'] == 'send':
        print(f"[+] {message['payload']}")
    else:
        print(message)

device = frida.get_usb_device()
pid = int(sys.argv[1]) if len(sys.argv) > 1 else None
session = device.attach(pid)
script = session.create_script("""
    // 假设 fs_agent.js 中导出了一个可以获取 AbortController 状态的函数
    // 实际情况需要根据 fs_agent.js 的具体实现来调整
    send(Module.findExportByName(null, 'getAbortControllerStatus')());
""")
script.on('message', on_message)
script.load()
sys.stdin.read()
```

**逻辑推理的假设输入与输出:**

**假设输入:** 目标进程尝试读取位于 `/tmp/test.txt` 的文件。

**预期输出 (取决于 `fs_agent.js` 的具体实现):**

- **监控模式:** `fs_agent.js` 可能会记录下这次读取操作的元数据，例如文件路径、操作类型、时间戳等。
- **控制模式:**
    - 如果配置为阻止读取特定文件，`fs_agent.js` 可能会阻止这次 `open()` 或 `read()` 系统调用，并返回一个错误给目标进程。
    - 如果配置为修改读取内容，`fs_agent.js` 可能会在 `read()` 操作返回数据前修改数据内容。

**用户或编程常见的使用错误:**

1. **Frida 未正确安装或配置:** 导致无法连接到目标进程或加载 agent。
2. **Agent 代码错误:**  JavaScript 代码编写错误会导致 agent 加载失败或运行时异常。
3. **权限问题:** Frida 需要足够的权限才能注入到目标进程。
4. **不了解目标进程的行为:**  可能错误地拦截了不相关的系统调用，或者对文件系统操作的理解有偏差。
5. **资源泄漏:** 在控制文件系统操作时，如果没有正确管理资源（例如未关闭打开的文件），可能导致资源泄漏。

**用户操作如何一步步到达这里 (调试线索):**

1. **用户想要监控或修改目标进程的文件系统行为。**
2. **用户选择使用 Frida 框架进行动态 instrumentation。**
3. **用户可能找到了或自己编写了一个名为 `fs_agent.js` 的 Frida agent，其目的是处理文件系统相关的操作。**
4. **用户编写 Frida Python 脚本，用于将 `fs_agent.js` 加载到目标进程中。**
5. **用户运行 Frida Python 脚本，并指定目标进程的 PID 或进程名称。**
6. **Frida 框架将 `fs_agent.js` 的代码注入到目标进程的 JavaScript 引擎中。**
7. **`fs_agent.js` 开始运行，并根据其代码逻辑拦截目标进程的文件系统相关操作。**

**功能归纳 (第 5 部分):**

到目前为止，根据提供的代码片段，`fs_agent.js` 的主要功能是构建一个用于**监控和潜在控制目标进程文件系统操作**的 Frida agent。它利用了 Node.js 的 Stream 和事件处理模型，并具备处理异步操作的能力。其核心在于拦截目标进程的文件系统调用，并允许开发者在其基础上实现更复杂的监控、分析或修改功能。后续的部分可能会揭示更具体的拦截和控制逻辑。

Prompt: 
```
这是目录为frida/build/subprojects/frida-tools/agents/fs/fs_agent.js的frida Dynamic instrumentation tool的源代码文件， 请列举一下它的功能, 
如果涉及到二进制底层，linux内核，请做出对应的举例说明，
请给出用lldb指令或者lldb python脚本，用来复刻的源代码所实现调试功能的示例，如果源代码是调试功能的实现。
如果做了逻辑推理，请给出假设输入与输出,
如果涉及用户或者编程常见的使用错误，请举例说明,
说明用户操作是如何一步步的到达这里，作为调试线索，
请用中文回复。
这是第5部分，共12部分，请归纳一下它的功能

"""
AS0C,IAAIJ,EAAKC,GAClBC,EAAM1B,EAAsB0B,EAAKF,GAEL,IAAxBG,EAAahB,QACfgB,EAAaE,SAASC,IACpBJ,EAAII,EAAMR,MAAQtB,EAAsB8B,EAAON,EAAI,IAGvDpC,MAAMoC,GAAOE,CACf,QAiBO,MAAMK,mBAAmBC,MAC9BC,cACEC,MAAM,6BACNb,KAAKtB,KAAO,YACZsB,KAAKC,KAAO,YACd,EAGFC,EAAE,sBAAuB,6CAA8CS,OACvET,EAAE,0BAA2B,sBAAuBY,WACpDZ,EAAE,uBAAwB,wBAAyBY,WACnDZ,EAAE,wBAAyB,yBAA0BY,UAAWC,YAChEb,EAAE,2BAA4B,uBAAwBY,UAAWC,YACjEb,EAAE,mBAAoB,qCAAsCY,WAC5DZ,EAAE,6BAA8B,mCAAoCS,OACpET,EAAE,mBAAoB,mBAAoBY,WAC1CZ,EAAE,wBAAyB,iCAAkCS,OAC7DT,EAAE,mBAAoB,eAAgBa,YACtCb,EAAE,8BACA,6CACAS,OACFT,EAAE,yBAA0B,4BAA6BS,OACzDT,EAAE,uBAAwB,8CAA+CS,OACzET,EAAE,yBAA0B,sCAAuCY,WACnEZ,EAAE,6BAA8B,kBAAmBS,OACnDT,EAAE,4BAA6B,0BAA2BS,OAC1DT,EAAE,qCACA,mCAAoCS,OACtCT,EAAE,6BAA8B,kBAAmBS,OACnDT,EAAE,uBAAwB,uBAAwBY"}
✄
import{format as r}from"util";const e=new Map;export const codes={};export function aggregateTwoErrors(r,e){if(r&&e&&r!==e){if(Array.isArray(e.errors))return e.errors.push(r),e;const t=new AggregateError([e,r],e.message);return t.code=e.code,t}return r||e}function t(t,E){return function(...o){const n=new t,a=function(t,E,o){const n=e.get(t);if("function"==typeof n)return Reflect.apply(n,o,E);(n.match(/%[dfijoOs]/g)||[]).length;return 0===E.length?n:(E.unshift(n),Reflect.apply(r,null,E))}(E,o,n);return Object.defineProperties(n,{message:{value:a,enumerable:!1,writable:!0,configurable:!0},toString:{value(){return`${this.name} [${E}]: ${this.message}`},enumerable:!1,writable:!0,configurable:!0}}),n.code=E,n}}function E(r,E,o,...n){e.set(r,E),o=t(o,r),0!==n.length&&n.forEach((e=>{o[e.name]=t(e,r)})),codes[r]=o}export class AbortError extends Error{constructor(){super("The operation was aborted"),this.code="ABORT_ERR",this.name="AbortError"}}E("ERR_EVENT_RECURSION",'The event "%s" is already being dispatched',Error),E("ERR_ILLEGAL_CONSTRUCTOR","Illegal constructor",TypeError),E("ERR_INVALID_ARG_TYPE","Invalid argument type",TypeError),E("ERR_INVALID_ARG_VALUE","Invalid argument value",TypeError,RangeError),E("ERR_INVALID_RETURN_VALUE","Invalid return value",TypeError,RangeError),E("ERR_INVALID_THIS",'Value of "this" must be of type %s',TypeError),E("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),E("ERR_MISSING_ARGS","Missing argument",TypeError),E("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),E("ERR_OUT_OF_RANGE","Out of range",RangeError),E("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),E("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),E("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),E("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),E("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),E("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),E("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),E("ERR_STREAM_WRITE_AFTER_END","write after end",Error),E("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);
✄
{"version":3,"file":"abort_controller.js","names":["errorCodes","defineEventHandler","EventTarget","Event","kTrustEvent","inspect","ERR_ILLEGAL_CONSTRUCTOR","ERR_INVALID_THIS","kAborted","Symbol","customInspect","self","obj","depth","options","opts","Object","assign","constructor","name","AbortSignal","aborted","undefined","validateAbortSignal","this","custom","static","createAbortSignal","signal","setPrototypeOf","prototype","defineProperties","enumerable","defineProperty","toStringTag","writable","configurable","value","kSignal","validateAbortController","AbortController","abort","event","dispatchEvent","abortSignal"],"sourceRoot":"/root/frida/build/subprojects/frida-tools/agents/fs/fs_agent.js.p/node_modules/@frida/readable-stream/lib/","sources":[""],"mappings":"gBAGkBA,MAAkB,4CAElCC,iBACAC,WACAC,iBACAC,MACK,sCAEEC,MAAe,OAExB,MAAMC,wBACJA,EAAuBC,iBACvBA,GACEP,SAEG,MAAMQ,SAAWC,OAAO,YAE/B,SAASC,EAAcC,EAAMC,EAAKC,EAAOC,GACvC,GAAID,EAAQ,EACV,OAAOF,EAET,MAAMI,EAAOC,OAAOC,OAAO,CAAC,EAAGH,EAAS,CACtCD,MAAyB,OAAlBC,EAAQD,MAAiB,KAAOC,EAAQD,MAAQ,IAGzD,MAAO,GAAGF,EAAKO,YAAYC,QAAQd,EAAQO,EAAKG,IAClD,QAOO,MAAMK,oBAAoBlB,EAC/BgB,cACE,MAAM,IAAIZ,CACZ,CAEIe,cAEF,OAZJ,SAA6BT,GAC3B,QAAwBU,IAApBV,IAAMJ,UACR,MAAM,IAAID,EAAiB,cAC/B,CAQIgB,CAAoBC,QACXA,KAAKhB,SAChB,CAEA,CAACH,EAAQoB,QAAQZ,EAAOC,GACtB,OAAOJ,EAAcc,KAAM,CACzBH,QAASG,KAAKH,SACbR,EAAOC,EACZ,CAEAY,eACE,OAAOC,GAAkB,EAC3B,EAgBF,SAASA,EAAkBN,GAAU,GACnC,MAAMO,EAAS,IAAI1B,EAGnB,OAFAc,OAAOa,eAAeD,EAAQR,YAAYU,WAC1CF,EAAOpB,UAAYa,EACZO,CACT,CAlBAZ,OAAOe,iBAAiBX,YAAYU,UAAW,CAC7CT,QAAS,CAAEW,YAAY,KAGzBhB,OAAOiB,eAAeb,YAAYU,UAAWrB,OAAOyB,YAAa,CAC/DC,UAAU,EACVH,YAAY,EACZI,cAAc,EACdC,MAAO,gBAGTpC,EAAmBmB,YAAYU,UAAW,SAqB1C,MAAMQ,EAAU7B,OAAO,UAEvB,SAAS8B,EAAwB3B,GAC/B,QAAuBU,IAAnBV,IAAM0B,GACR,MAAM,IAAI/B,EAAiB,kBAC/B,QAEO,MAAMiC,gBACXtB,cACEM,KAAKc,GAAWX,GAClB,CAEIC,aAEF,OADAW,EAAwBf,MACjBA,KAAKc,EACd,CAEAG,QACEF,EAAwBf,MA9B5B,SAAqBI,GACnB,GAAIA,EAAOpB,UAAW,OACtBoB,EAAOpB,WAAY,EACnB,MAAMkC,EAAQ,IAAIvC,EAAM,QAAS,CAC/BC,CAACA,IAAc,IAEjBwB,EAAOe,cAAcD,EACvB,CAwBIE,CAAYpB,KAAKc,GACnB,CAEA,CAACjC,EAAQoB,QAAQZ,EAAOC,GACtB,OAAOJ,EAAcc,KAAM,CACzBI,OAAQJ,KAAKI,QACZf,EAAOC,EACZ,EAGFE,OAAOe,iBAAiBS,gBAAgBV,UAAW,CACjDF,OAAQ,CAAEI,YAAY,GACtBS,MAAO,CAAET,YAAY,KAGvBhB,OAAOiB,eAAeO,gBAAgBV,UAAWrB,OAAOyB,YAAa,CACnEC,UAAU,EACVH,YAAY,EACZI,cAAc,EACdC,MAAO"}
✄
import{codes as t}from"../errors.js";import{defineEventHandler as r,EventTarget as o,Event as e,kTrustEvent as n}from"./event_target.js";import{inspect as i}from"util";const{ERR_ILLEGAL_CONSTRUCTOR:b,ERR_INVALID_THIS:l}=t;export const kAborted=Symbol("kAborted");function s(t,r,o,e){if(o<0)return t;const n=Object.assign({},e,{depth:null===e.depth?null:e.depth-1});return`${t.constructor.name} ${i(r,n)}`}export class AbortSignal extends o{constructor(){throw new b}get aborted(){return function(t){if(void 0===t?.[kAborted])throw new l("AbortSignal")}(this),!!this[kAborted]}[i.custom](t,r){return s(this,{aborted:this.aborted},t,r)}static abort(){return a(!0)}}function a(t=!1){const r=new o;return Object.setPrototypeOf(r,AbortSignal.prototype),r[kAborted]=t,r}Object.defineProperties(AbortSignal.prototype,{aborted:{enumerable:!0}}),Object.defineProperty(AbortSignal.prototype,Symbol.toStringTag,{writable:!1,enumerable:!1,configurable:!0,value:"AbortSignal"}),r(AbortSignal.prototype,"abort");const c=Symbol("signal");function u(t){if(void 0===t?.[c])throw new l("AbortController")}export class AbortController{constructor(){this[c]=a()}get signal(){return u(this),this[c]}abort(){u(this),function(t){if(t[kAborted])return;t[kAborted]=!0;const r=new e("abort",{[n]:!0});t.dispatchEvent(r)}(this[c])}[i.custom](t,r){return s(this,{signal:this.signal},t,r)}}Object.defineProperties(AbortController.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),Object.defineProperty(AbortController.prototype,Symbol.toStringTag,{writable:!1,enumerable:!1,configurable:!0,value:"AbortController"});
✄
{"version":3,"file":"add-abort-signal.js","names":["eos","AbortError","errorCodes","ERR_INVALID_ARG_TYPE","addAbortSignal","signal","stream","name","validateAbortSignal","obj","pipe","module","exports","addAbortSignalNoValidate","onAbort","destroy","aborted","addEventListener","removeEventListener"],"sourceRoot":"/root/frida/build/subprojects/frida-tools/agents/fs/fs_agent.js.p/node_modules/@frida/readable-stream/lib/","sources":[""],"mappings":"OAAOA,MAAS,0CAEdC,WACSC,MACJ,eAEP,MAAMC,qBAAEA,GAAyBD,SAgB1B,SAASE,eAAeC,EAAQC,GAErC,GAb0B,EAACD,EAAQE,KACnC,GAAsB,iBAAXF,KACJ,YAAaA,GAClB,MAAM,IAAIF,EAAqBI,EAAM,cAAeF,EACtD,EAQAG,CAAoBH,EAAQ,YALRI,EAMFH,IALmB,mBAAbG,EAAIC,KAM1B,MAAM,IAAIP,EAAqB,SAAU,gBAAiBG,GAP9D,IAAsBG,EASpB,OAAOE,OAAOC,QAAQC,yBAAyBR,EAAQC,EACzD,QAEO,SAASO,yBAAyBR,EAAQC,GAC/C,GAAsB,iBAAXD,KAAyB,YAAaA,GAC/C,OAAOC,EAET,MAAMQ,EAAU,KACdR,EAAOS,QAAQ,IAAId,EAAa,EAQlC,OANII,EAAOW,QACTF,KAEAT,EAAOY,iBAAiB,QAASH,GACjCd,EAAIM,GAAQ,IAAMD,EAAOa,oBAAoB,QAASJ,MAEjDR,CACT"}
✄
import t from"./end-of-stream.js";import{AbortError as e,codes as o}from"../errors.js";const{ERR_INVALID_ARG_TYPE:r}=o;export function addAbortSignal(t,e){if(((t,e)=>{if("object"!=typeof t||!("aborted"in t))throw new r(e,"AbortSignal",t)})(t,"signal"),!(o=e)||"function"!=typeof o.pipe)throw new r("stream","stream.Stream",e);var o;return module.exports.addAbortSignalNoValidate(t,e)}export function addAbortSignalNoValidate(o,r){if("object"!=typeof o||!("aborted"in o))return r;const n=()=>{r.destroy(new e)};return o.aborted?n():(o.addEventListener("abort",n),t(r,(()=>o.removeEventListener("abort",n)))),r}
✄
{"version":3,"file":"buffer_list.js","names":["Buffer","inspect","BufferList","constructor","this","head","tail","length","push","v","entry","data","next","unshift","shift","ret","clear","join","s","p","concat","n","alloc","allocUnsafe","i","set","consume","hasStrings","slice","_getString","_getBuffer","first","Symbol","iterator","c","str","retLen","buf","Uint8Array","buffer","byteOffset","custom","_","options","depth","customInspect"],"sourceRoot":"/root/frida/build/subprojects/frida-tools/agents/fs/fs_agent.js.p/node_modules/@frida/readable-stream/lib/","sources":[""],"mappings":"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"}
✄
import{Buffer as t}from"buffer";import{inspect as e}from"util";export default class h{constructor(){this.head=null,this.tail=null,this.length=0}push(t){const e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length}unshift(t){const e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}shift(){if(0===this.length)return;const t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}clear(){this.head=this.tail=null,this.length=0}join(t){if(0===this.length)return"";let e=this.head,h=""+e.data;for(;e=e.next;)h+=t+e.data;return h}concat(e){if(0===this.length)return t.alloc(0);const h=t.allocUnsafe(e>>>0);let i=this.head,s=0;for(;i;)h.set(i.data,s),s+=i.data.length,i=i.next;return h}consume(t,e){const h=this.head.data;if(t<h.length){const e=h.slice(0,t);return this.head.data=h.slice(t),e}return t===h.length?this.shift():e?this._getString(t):this._getBuffer(t)}first(){return this.head.data}*[Symbol.iterator](){for(let t=this.head;t;t=t.next)yield t.data}_getString(t){let e="",h=this.head,i=0;do{const s=h.data;if(!(t>s.length)){t===s.length?(e+=s,++i,h.next?this.head=h.next:this.head=this.tail=null):(e+=s.slice(0,t),this.head=h,h.data=s.slice(t));break}e+=s,t-=s.length,++i}while(h=h.next);return this.length-=i,e}_getBuffer(e){const h=t.allocUnsafe(e),i=e;let s=this.head,n=0;do{const t=s.data;if(!(e>t.length)){e===t.length?(h.set(t,i-e),++n,s.next?this.head=s.next:this.head=this.tail=null):(h.set(new Uint8Array(t.buffer,t.byteOffset,e),i-e),this.head=s,s.data=t.slice(e));break}h.set(t,i-e),e-=t.length,++n}while(s=s.next);return this.length-=n,h}[e.custom](t,h){return e(this,{...h,depth:0,customInspect:!1})}}
✄
{"version":3,"file":"compose.js","names":["destroyer","Duplex","AbortError","errorCodes","pipeline","isNodeStream","isReadable","isWritable","ERR_INVALID_ARG_VALUE","ERR_MISSING_ARGS","ComposeDuplex","constructor","options","super","readable","this","_readableState","ended","endEmitted","writable","_writableState","ending","finished","compose","streams","length","from","orgStreams","idx","n","ondrain","onfinish","onreadable","onclose","d","head","tail","err","cb","destroy","writableObjectMode","readableObjectMode","_write","chunk","encoding","callback","write","_final","end","on","push","_read","buf","read","_destroy"],"sourceRoot":"/root/frida/build/subprojects/frida-tools/agents/fs/fs_agent.js.p/node_modules/@frida/readable-stream/lib/","sources":[""],"mappings":"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"}
✄
import{destroyer as t}from"./destroy.js";import e from"./duplex.js";import{AbortError as n,codes as r}from"../errors.js";import{pipeline as i}from"./pipeline.js";import{isNodeStream as o,isReadable as l,isWritable as a}from"./utils.js";const{ERR_INVALID_ARG_VALUE:s,ERR_MISSING_ARGS:f}=r;class d extends e{constructor(t){super(t),!1===t?.readable&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===t?.writable&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}export default function u(...r){if(0===r.length)throw new f("streams");if(1===r.length)return e.from(r[0]);const u=[...r];if("function"==typeof r[0]&&(r[0]=e.from(r[0])),"function"==typeof r[r.length-1]){const t=r.length-1;r[t]=e.from(r[t])}for(let t=0;t<r.length;++t)if(o(r[t])){if(t<r.length-1&&!l(r[t]))throw new s(`streams[${t}]`,u[t],"must be readable");if(t>0&&!a(r[t]))throw new s(`streams[${t}]`,u[t],"must be writable")}let c,b,w,h,m;const _=r[0],p=i(r,(function(t){const e=h;h=null,e?e(t):t?m.destroy(t):j||S||m.destroy()})),S=!!a(_),j=!!l(p);return m=new d({writableObjectMode:!!_?.writableObjectMode,readableObjectMode:!!p?.writableObjectMode,writable:S,readable:j}),S&&(m._write=function(t,e,n){_.write(t,e)?n():c=n},m._final=function(t){_.end(),b=t},_.on("drain",(function(){if(c){const t=c;c=null,t()}})),p.on("finish",(function(){if(b){const t=b;b=null,t()}}))),j&&(p.on("readable",(function(){if(w){const t=w;w=null,t()}})),p.on("end",(function(){m.push(null)})),m._read=function(){for(;;){const t=p.read();if(null===t)return void(w=m._read);if(!m.push(t))return}}),m._destroy=function(e,r){e||null===h||(e=new n),w=null,c=null,b=null,null===h?r(e):(h=r,t(p,e))},m}
✄
{"version":3,"file":"destroy.js","names":["aggregateTwoErrors","errorCodes","AbortError","kDestroyed","isDestroyed","isFinished","isServerRequest","process","ERR_MULTIPLE_CALLBACK","kDestroy","Symbol","kConstruct","checkError","err","w","r","stack","errored","destroy","cb","this","_readableState","_writableState","s","destroyed","constructed","_destroy","once","er","self","called","onDestroy","closed","nextTick","emitErrorCloseNT","emitCloseNT","result","then","call","emitErrorNT","closeEmitted","emitClose","emit","errorEmitted","undestroy","reading","ended","readable","endEmitted","finalCalled","prefinished","writable","ending","finished","errorOrDestroy","stream","sync","autoDestroy","construct","_construct","listenerCount","constructNT","onConstruct","emitConstructNT","isRequest","setHeader","abort","emitCloseLegacy","emitErrorCloseLegacy","destroyer","socket","req","close"],"sourceRoot":"/root/frida/build/subprojects/frida-tools/agents/fs/fs_agent.js.p/node_modules/@frida/readable-stream/lib/","sources":[""],"mappings":"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"}
✄
import{aggregateTwoErrors as t,codes as e,AbortError as r}from"../errors.js";import{kDestroyed as o,isDestroyed as n,isFinished as c,isServerRequest as i}from"./utils.js";import s from"process";const{ERR_MULTIPLE_CALLBACK:d}=e,l=Symbol("kDestroy"),a=Symbol("kConstruct");function u(t,e,r){t&&(t.stack,e&&!e.errored&&(e.errored=t),r&&!r.errored&&(r.errored=t))}export function destroy(e,r){const o=this._readableState,n=this._writableState,c=n||o;return n&&n.destroyed||o&&o.destroyed?("function"==typeof r&&r(),this):(u(e,n,o),n&&(n.destroyed=!0),o&&(o.destroyed=!0),c.constructed?f(this,e,r):this.once(l,(function(o){f(this,t(o,e),r)})),this)}function f(t,e,r){let o=!1;function n(e){if(o)return;o=!0;const n=t._readableState,c=t._writableState;u(e,c,n),c&&(c.closed=!0),n&&(n.closed=!0),"function"==typeof r&&r(e),e?s.nextTick(y,t,e):s.nextTick(m,t)}try{const r=t._destroy(e||null,n);if(null!=r){const t=r.then;"function"==typeof t&&t.call(r,(function(){s.nextTick(n,null)}),(function(t){s.nextTick(n,t)}))}}catch(e){n(e)}}function y(t,e){b(t,e),m(t)}function m(t){const e=t._readableState,r=t._writableState;r&&(r.closeEmitted=!0),e&&(e.closeEmitted=!0),(r&&r.emitClose||e&&e.emitClose)&&t.emit("close")}function b(t,e){const r=t._readableState,o=t._writableState;o&&o.errorEmitted||r&&r.errorEmitted||(o&&(o.errorEmitted=!0),r&&(r.errorEmitted=!0),t.emit("error",e))}export function undestroy(){const t=this._readableState,e=this._writableState;t&&(t.constructed=!0,t.closed=!1,t.closeEmitted=!1,t.destroyed=!1,t.errored=null,t.errorEmitted=!1,t.reading=!1,t.ended=!1===t.readable,t.endEmitted=!1===t.readable),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=!1===e.writable,e.ending=!1===e.writable,e.finished=!1===e.writable)}export function errorOrDestroy(t,e,r){const o=t._readableState,n=t._writableState;if(n&&n.destroyed||o&&o.destroyed)return this;o&&o.autoDestroy||n&&n.autoDestroy?t.destroy(e):e&&(e.stack,n&&!n.errored&&(n.errored=e),o&&!o.errored&&(o.errored=e),r?s.nextTick(b,t,e):b(t,e))}export function construct(t,e){if("function"!=typeof t._construct)return;const r=t._readableState,o=t._writableState;r&&(r.constructed=!1),o&&(o.constructed=!1),t.once(a,e),t.listenerCount(a)>1||s.nextTick(_,t)}function _(t){let e=!1;function r(r){if(e)return void errorOrDestroy(t,r??new d);e=!0;const o=t._readableState,n=t._writableState,c=n||o;o&&(o.constructed=!0),n&&(n.constructed=!0),c.destroyed?t.emit(l,r):r?errorOrDestroy(t,r,!0):s.nextTick(p,t)}try{const e=t._construct(r);if(null!=e){const t=e.then;"function"==typeof t&&t.call(e,(function(){s.nextTick(r,null)}),(function(t){s.nextTick(r,t)}))}}catch(t){r(t)}}function p(t){t.emit(a)}function S(t){return t&&t.setHeader&&"function"==typeof t.abort}function k(t){t.emit("close")}function x(t,e){t.emit("error",e),s.nextTick(k,t)}export function destroyer(t,e){t&&!n(t)&&(e||c(t)||(e=new r),i(t)?(t.socket=null,t.destroy(e)):S(t)?t.abort():S(t.req)?t.req.abort():"function"==typeof t.destroy?t.destroy(e):"function"==typeof t.close?t.close():e?s.nextTick(x,t):s.nextTick(k,t),t.destroyed||(t[o]=!0))}
✄
{"version":3,"file":"duplex.js","names":["AbortController","destroyer","eos","AbortError","errorCodes","from","Readable","isReadable","isWritable","isIterable","isNodeStream","isReadableNodeStream","isWritableNodeStream","isDuplexNodeStream","Writable","process","ERR_INVALID_ARG_TYPE","ERR_INVALID_RETURN_VALUE","Object","setPrototypeOf","Duplex","prototype","method","keys","options","this","call","allowHalfOpen","readable","_readableState","ended","endEmitted","writable","_writableState","ending","finished","defineProperties","getOwnPropertyDescriptor","writableHighWaterMark","writableObjectMode","writableBuffer","writableLength","writableFinished","writableCorked","writableEnded","writableNeedDrain","destroyed","get","undefined","set","value","body","duplexify","Duplexify","constructor","super","name","_duplexify","write","final","destroy","fn","promise","resolve","createDeferredPromise","ac","signal","async","chunk","done","cb","nextTick","aborted","encoding","err","abort","fromAsyncGen","objectMode","then","d","val","push","read","pair","r","wrap","w","ondrain","onfinish","onreadable","onclose","onfinished","readableObjectMode","_write","callback","_final","end","on","_read","buf","_destroy","reject","Promise","res","rej"],"sourceRoot":"/root/frida/build/subprojects/frida-tools/agents/fs/fs_agent.js.p/node_modules/@frida/readable-stream/lib/","sources":[""],"mappings":"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"}
✄
import{AbortController as e}from"./abort_controller.js";import{destroyer as t}from"./destroy.js";import r from"./end-of-stream.js";import{AbortError as a,codes as o}from"../errors.js";import i from"./from.js";import n from"./readable.js";import{isReadable as l,isWritable as b,isIterable as d,isNodeStream as s,isReadableNod
"""


```