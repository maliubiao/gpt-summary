Response:
### 功能归纳

`droidy-host-session.vala` 文件是 Frida 工具中用于管理 Android 设备上的会话的核心模块。它主要负责与 Android 设备的交互，包括会话的创建、管理、销毁以及与设备的通信。以下是该文件的主要功能：

1. **会话管理**：
   - 负责创建和管理与 Android 设备的会话。
   - 处理会话的附加（attach）和分离（detach）操作。
   - 管理会话的生命周期，包括会话的创建、销毁和状态监控。

2. **通信管理**：
   - 通过 D-Bus 与 Android 设备进行通信。
   - 处理 D-Bus 连接的建立、关闭和错误处理。
   - 管理 D-Bus 对象的注册和注销。

3. **Gadget 管理**：
   - 管理 Gadget 的加载和卸载。
   - 处理 Gadget 的会话生命周期，包括 Gadget 的附加和分离。
   - 监控 Gadget 的状态变化，并在 Gadget 分离时触发相应的事件。

4. **远程服务器管理**：
   - 管理远程服务器的连接和会话。
   - 处理远程服务器的会话生命周期，包括会话的创建、销毁和状态监控。
   - 支持不同类型的远程服务器（如常规服务器和 Gadget 服务器）。

5. **错误处理**：
   - 处理会话和通信中的错误，确保系统的稳定性。
   - 在会话分离或通信中断时，触发相应的事件并清理资源。

### 二进制底层与 Linux 内核

该文件主要涉及 Android 设备的会话管理，不直接涉及 Linux 内核的底层操作。然而，Frida 作为一个动态插桩工具，可能会通过 Android 的底层接口与 Linux 内核进行交互，例如通过 `ptrace` 系统调用进行进程调试。

### LLDB 调试示例

假设我们需要调试 `GadgetEntry` 类的 `close` 方法，可以使用以下 LLDB 命令或 Python 脚本：

#### LLDB 命令

```lldb
b droidy-host-session.vala:123  # 假设 close 方法在第123行
r
p local_session_id
p host_session
p connection
```

#### LLDB Python 脚本

```python
import lldb

def debug_close_method(debugger, command, result, internal_dict):
    target = debugger.GetSelectedTarget()
    process = target.GetProcess()
    thread = process.GetSelectedThread()
    frame = thread.GetSelectedFrame()

    # 设置断点
    breakpoint = target.BreakpointCreateByLocation("droidy-host-session.vala", 123)
    if not breakpoint.IsValid():
        print("Failed to set breakpoint")
        return

    # 运行到断点
    process.Continue()

    # 打印变量
    local_session_id = frame.FindVariable("local_session_id")
    host_session = frame.FindVariable("host_session")
    connection = frame.FindVariable("connection")

    print(f"local_session_id: {local_session_id.GetValue()}")
    print(f"host_session: {host_session.GetValue()}")
    print(f"connection: {connection.GetValue()}")

# 注册命令
def __lldb_init_module(debugger, internal_dict):
    debugger.HandleCommand('command script add -f debug_close_method debug_close')
```

### 逻辑推理与假设输入输出

假设 `GadgetEntry` 类的 `close` 方法被调用，输入是一个 `Cancellable` 对象，输出是一个 `IOError` 异常或成功关闭会话。

- **输入**：`Cancellable` 对象，用于控制异步操作的取消。
- **输出**：
  - 成功：无返回值，会话关闭。
  - 失败：抛出 `IOError` 异常。

### 用户常见错误

1. **会话未正确关闭**：
   - 用户可能在会话未完全关闭时就尝试重新连接，导致资源泄漏。
   - **解决方法**：确保在关闭会话时等待 `close` 方法完成。

2. **D-Bus 连接中断**：
   - 用户可能在 D-Bus 连接中断时未正确处理，导致会话无法恢复。
   - **解决方法**：在 `on_connection_closed` 方法中处理连接中断，并触发会话分离事件。

### 用户操作步骤

1. **启动 Frida 服务器**：
   - 用户在 Android 设备上启动 Frida 服务器。

2. **连接到设备**：
   - 用户通过 Frida 客户端连接到 Android 设备。

3. **创建会话**：
   - 用户创建一个新的会话，Frida 客户端通过 D-Bus 与 Android 设备通信。

4. **附加到进程**：
   - 用户选择要调试的进程并附加到该进程。

5. **执行调试操作**：
   - 用户执行各种调试操作，如注入脚本、监控函数调用等。

6. **分离会话**：
   - 用户完成调试后，分离会话并关闭连接。

7. **关闭会话**：
   - Frida 客户端调用 `close` 方法关闭会话，确保资源释放。

通过以上步骤，用户可以逐步操作并到达 `droidy-host-session.vala` 文件中的相关代码，进行调试和分析。
Prompt: 
```
这是目录为frida/subprojects/frida-core/src/droidy/droidy-host-session.vala的frida Dynamic instrumentation tool的源代码文件， 请列举一下它的功能, 
如果涉及到二进制底层，linux内核，请做出对应的举例说明，
请给出用lldb指令或者lldb python脚本，用来复刻的源代码所实现调试功能的示例，如果源代码是调试功能的实现。
如果做了逻辑推理，请给出假设输入与输出,
如果涉及用户或者编程常见的使用错误，请举例说明,
说明用户操作是如何一步步的到达这里，作为调试线索，
请用中文回复。
这是第5部分，共5部分，请归纳一下它的功能

"""
0x63, 0x68, 0x65, 0x72, 0x50, 0x61, 0x63, 0x6b,
			0x61, 0x67, 0x65, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x04, 0x64, 0x72, 0x61, 0x77, 0x00, 0x16, 0x65, 0x6e, 0x75, 0x6d,
			0x65, 0x72, 0x61, 0x74, 0x65, 0x2d, 0x61, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x73, 0x00,
			0x13, 0x65, 0x6e, 0x75, 0x6d, 0x65, 0x72, 0x61, 0x74, 0x65, 0x2d, 0x70, 0x72, 0x6f, 0x63, 0x65, 0x73, 0x73, 0x65,
			0x73, 0x00, 0x15, 0x65, 0x6e, 0x75, 0x6d, 0x65, 0x72, 0x61, 0x74, 0x65, 0x41, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61,
			0x74, 0x69, 0x6f, 0x6e, 0x73, 0x00, 0x12, 0x65, 0x6e, 0x75, 0x6d, 0x65, 0x72, 0x61, 0x74, 0x65, 0x50, 0x72, 0x6f,
			0x63, 0x65, 0x73, 0x73, 0x65, 0x73, 0x00, 0x06, 0x65, 0x71, 0x75, 0x61, 0x6c, 0x73, 0x00, 0x03, 0x65, 0x72, 0x72,
			0x00, 0x03, 0x65, 0x78, 0x65, 0x00, 0x04, 0x65, 0x78, 0x69, 0x74, 0x00, 0x0c, 0x66, 0x65, 0x74, 0x63, 0x68, 0x41,
			0x70, 0x70, 0x49, 0x63, 0x6f, 0x6e, 0x00, 0x12, 0x66, 0x65, 0x74, 0x63, 0x68, 0x41, 0x70, 0x70, 0x50, 0x61, 0x72,
			0x61, 0x6d, 0x65, 0x74, 0x65, 0x72, 0x73, 0x00, 0x0f, 0x66, 0x65, 0x74, 0x63, 0x68, 0x41, 0x70, 0x70, 0x53, 0x6f,
			0x75, 0x72, 0x63, 0x65, 0x73, 0x00, 0x04, 0x66, 0x69, 0x6e, 0x64, 0x00, 0x05, 0x66, 0x6c, 0x61, 0x67, 0x73, 0x00,
			0x05, 0x66, 0x6c, 0x75, 0x73, 0x68, 0x00, 0x07, 0x66, 0x6f, 0x72, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x06, 0x66, 0x6f,
			0x72, 0x6d, 0x61, 0x74, 0x00, 0x09, 0x66, 0x72, 0x6f, 0x6e, 0x74, 0x6d, 0x6f, 0x73, 0x74, 0x00, 0x03, 0x67, 0x65,
			0x74, 0x00, 0x19, 0x67, 0x65, 0x74, 0x2d, 0x66, 0x72, 0x6f, 0x6e, 0x74, 0x6d, 0x6f, 0x73, 0x74, 0x2d, 0x61, 0x70,
			0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x00, 0x0f, 0x67, 0x65, 0x74, 0x41, 0x62, 0x73, 0x6f, 0x6c,
			0x75, 0x74, 0x65, 0x50, 0x61, 0x74, 0x68, 0x00, 0x0f, 0x67, 0x65, 0x74, 0x41, 0x70, 0x70, 0x50, 0x72, 0x6f, 0x63,
			0x65, 0x73, 0x73, 0x65, 0x73, 0x00, 0x12, 0x67, 0x65, 0x74, 0x41, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69,
			0x6f, 0x6e, 0x49, 0x63, 0x6f, 0x6e, 0x00, 0x12, 0x67, 0x65, 0x74, 0x41, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74,
			0x69, 0x6f, 0x6e, 0x49, 0x6e, 0x66, 0x6f, 0x00, 0x08, 0x67, 0x65, 0x74, 0x42, 0x79, 0x74, 0x65, 0x73, 0x00, 0x08,
			0x67, 0x65, 0x74, 0x43, 0x61, 0x75, 0x73, 0x65, 0x00, 0x10, 0x67, 0x65, 0x74, 0x44, 0x65, 0x63, 0x6c, 0x61, 0x72,
			0x65, 0x64, 0x46, 0x69, 0x65, 0x6c, 0x64, 0x00, 0x11, 0x67, 0x65, 0x74, 0x44, 0x65, 0x63, 0x6c, 0x61, 0x72, 0x65,
			0x64, 0x4d, 0x65, 0x74, 0x68, 0x6f, 0x64, 0x00, 0x17, 0x67, 0x65, 0x74, 0x46, 0x69, 0x6c, 0x65, 0x43, 0x6f, 0x6e,
			0x74, 0x65, 0x6e, 0x74, 0x73, 0x41, 0x73, 0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x00, 0x17, 0x67, 0x65, 0x74, 0x46,
			0x72, 0x6f, 0x6e, 0x74, 0x6d, 0x6f, 0x73, 0x74, 0x41, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e,
			0x00, 0x17, 0x67, 0x65, 0x74, 0x46, 0x72, 0x6f, 0x6e, 0x74, 0x6d, 0x6f, 0x73, 0x74, 0x50, 0x61, 0x63, 0x6b, 0x61,
			0x67, 0x65, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x0e, 0x67, 0x65, 0x74, 0x49, 0x6e, 0x70, 0x75, 0x74, 0x53, 0x74, 0x72,
			0x65, 0x61, 0x6d, 0x00, 0x06, 0x67, 0x65, 0x74, 0x49, 0x6e, 0x74, 0x00, 0x12, 0x67, 0x65, 0x74, 0x49, 0x6e, 0x74,
			0x72, 0x69, 0x6e, 0x73, 0x69, 0x63, 0x48, 0x65, 0x69, 0x67, 0x68, 0x74, 0x00, 0x11, 0x67, 0x65, 0x74, 0x49, 0x6e,
			0x74, 0x72, 0x69, 0x6e, 0x73, 0x69, 0x63, 0x57, 0x69, 0x64, 0x74, 0x68, 0x00, 0x0c, 0x67, 0x65, 0x74, 0x4a, 0x53,
			0x4f, 0x4e, 0x41, 0x72, 0x72, 0x61, 0x79, 0x00, 0x17, 0x67, 0x65, 0x74, 0x4c, 0x61, 0x75, 0x6e, 0x63, 0x68, 0x65,
			0x72, 0x41, 0x70, 0x70, 0x6c, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x73, 0x00, 0x07, 0x67, 0x65, 0x74, 0x4e,
			0x61, 0x6d, 0x65, 0x00, 0x0f, 0x67, 0x65, 0x74, 0x4f, 0x75, 0x74, 0x70, 0x75, 0x74, 0x53, 0x74, 0x72, 0x65, 0x61,
			0x6d, 0x00, 0x0e, 0x67, 0x65, 0x74, 0x50, 0x61, 0x63, 0x6b, 0x61, 0x67, 0x65, 0x49, 0x6e, 0x66, 0x6f, 0x00, 0x11,
			0x67, 0x65, 0x74, 0x50, 0x61, 0x63, 0x6b, 0x61, 0x67, 0x65, 0x4d, 0x61, 0x6e, 0x61, 0x67, 0x65, 0x72, 0x00, 0x0e,
			0x67, 0x65, 0x74, 0x50, 0x61, 0x63, 0x6b, 0x61, 0x67, 0x65, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x16, 0x67, 0x65, 0x74,
			0x52, 0x75, 0x6e, 0x6e, 0x69, 0x6e, 0x67, 0x41, 0x70, 0x70, 0x50, 0x72, 0x6f, 0x63, 0x65, 0x73, 0x73, 0x65, 0x73,
			0x00, 0x0f, 0x67, 0x65, 0x74, 0x52, 0x75, 0x6e, 0x6e, 0x69, 0x6e, 0x67, 0x54, 0x61, 0x73, 0x6b, 0x73, 0x00, 0x09,
			0x67, 0x65, 0x74, 0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x00, 0x10, 0x67, 0x65, 0x74, 0x53, 0x79, 0x73, 0x74, 0x65,
			0x6d, 0x43, 0x6f, 0x6e, 0x74, 0x65, 0x78, 0x74, 0x00, 0x10, 0x67, 0x65, 0x74, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6d,
			0x53, 0x65, 0x72, 0x76, 0x69, 0x63, 0x65, 0x00, 0x0b, 0x67, 0x65, 0x74, 0x54, 0x69, 0x6d, 0x65, 0x5a, 0x6f, 0x6e,
			0x65, 0x00, 0x08, 0x67, 0x65, 0x74, 0x70, 0x77, 0x75, 0x69, 0x64, 0x00, 0x05, 0x67, 0x72, 0x6f, 0x75, 0x70, 0x00,
			0x10, 0x68, 0x61, 0x6e, 0x64, 0x6c, 0x65, 0x43, 0x6f, 0x6e, 0x6e, 0x65, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x00, 0x19,
			0x68, 0x61, 0x6e, 0x64, 0x6c, 0x65, 0x49, 0x6e, 0x63, 0x6f, 0x6d, 0x69, 0x6e, 0x67, 0x43, 0x6f, 0x6e, 0x6e, 0x65,
			0x63, 0x74, 0x69, 0x6f, 0x6e, 0x73, 0x00, 0x07, 0x68, 0x61, 0x73, 0x4e, 0x65, 0x78, 0x74, 0x00, 0x0a, 0x69, 0x6d,
			0x70, 0x6f, 0x72, 0x74, 0x61, 0x6e, 0x63, 0x65, 0x00, 0x07, 0x69, 0x6e, 0x64, 0x65, 0x78, 0x4f, 0x66, 0x00, 0x08,
			0x69, 0x6e, 0x74, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x00, 0x06, 0x69, 0x6e, 0x76, 0x6f, 0x6b, 0x65, 0x00, 0x0b, 0x69,
			0x73, 0x44, 0x69, 0x72, 0x65, 0x63, 0x74, 0x6f, 0x72, 0x79, 0x00, 0x07, 0x69, 0x73, 0x45, 0x6d, 0x70, 0x74, 0x79,
			0x00, 0x08, 0x69, 0x74, 0x65, 0x72, 0x61, 0x74, 0x6f, 0x72, 0x00, 0x06, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68, 0x00,
			0x09, 0x6c, 0x69, 0x73, 0x74, 0x46, 0x69, 0x6c, 0x65, 0x73, 0x00, 0x09, 0x6c, 0x6f, 0x61, 0x64, 0x4c, 0x61, 0x62,
			0x65, 0x6c, 0x00, 0x04, 0x6c, 0x6f, 0x6f, 0x70, 0x00, 0x10, 0x6d, 0x41, 0x63, 0x74, 0x69, 0x76, 0x69, 0x74, 0x79,
			0x4d, 0x61, 0x6e, 0x61, 0x67, 0x65, 0x72, 0x00, 0x09, 0x6d, 0x47, 0x65, 0x74, 0x70, 0x77, 0x75, 0x69, 0x64, 0x00,
			0x08, 0x6d, 0x49, 0x73, 0x6f, 0x38, 0x36, 0x30, 0x31, 0x00, 0x10, 0x6d, 0x4c, 0x61, 0x75, 0x6e, 0x63, 0x68, 0x65,
			0x72, 0x50, 0x6b, 0x67, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x15, 0x6d, 0x4d, 0x69, 0x6c, 0x6c, 0x69, 0x73, 0x65, 0x63,
			0x6f, 0x6e, 0x64, 0x73, 0x50, 0x65, 0x72, 0x4a, 0x69, 0x66, 0x66, 0x79, 0x00, 0x0f, 0x6d, 0x50, 0x61, 0x63, 0x6b,
			0x61, 0x67, 0x65, 0x4d, 0x61, 0x6e, 0x61, 0x67, 0x65, 0x72, 0x00, 0x0c, 0x6d, 0x50, 0x77, 0x6e, 0x61, 0x6d, 0x65,
			0x46, 0x69, 0x65, 0x6c, 0x64, 0x00, 0x07, 0x6d, 0x53, 0x6f, 0x63, 0x6b, 0x65, 0x74, 0x00, 0x0f, 0x6d, 0x53, 0x79,
			0x73, 0x74, 0x65, 0x6d, 0x42, 0x6f, 0x6f, 0x74, 0x54, 0x69, 0x6d, 0x65, 0x00, 0x11, 0x6d, 0x54, 0x6f, 0x70, 0x41,
			0x63, 0x74, 0x69, 0x76, 0x69, 0x74, 0x79, 0x46, 0x69, 0x65, 0x6c, 0x64, 0x00, 0x07, 0x6d, 0x57, 0x6f, 0x72, 0x6b,
			0x65, 0x72, 0x00, 0x04, 0x6d, 0x61, 0x69, 0x6e, 0x00, 0x07, 0x6d, 0x61, 0x74, 0x63, 0x68, 0x65, 0x72, 0x00, 0x05,
			0x6d, 0x79, 0x50, 0x69, 0x64, 0x00, 0x04, 0x6e, 0x61, 0x6d, 0x65, 0x00, 0x04, 0x6e, 0x65, 0x78, 0x74, 0x00, 0x03,
			0x6f, 0x75, 0x74, 0x00, 0x0b, 0x70, 0x61, 0x63, 0x6b, 0x61, 0x67, 0x65, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x08, 0x70,
			0x61, 0x72, 0x73, 0x65, 0x49, 0x6e, 0x74, 0x00, 0x09, 0x70, 0x61, 0x72, 0x73, 0x65, 0x4c, 0x6f, 0x6e, 0x67, 0x00,
			0x04, 0x70, 0x61, 0x74, 0x68, 0x00, 0x03, 0x70, 0x69, 0x64, 0x00, 0x07, 0x70, 0x6b, 0x67, 0x4c, 0x69, 0x73, 0x74,
			0x00, 0x04, 0x70, 0x70, 0x69, 0x64, 0x00, 0x07, 0x70, 0x72, 0x65, 0x70, 0x61, 0x72, 0x65, 0x00, 0x07, 0x70, 0x72,
			0x69, 0x6e, 0x74, 0x6c, 0x6e, 0x00, 0x0f, 0x70, 0x75, 0x62, 0x6c, 0x69, 0x63, 0x53, 0x6f, 0x75, 0x72, 0x63, 0x65,
			0x44, 0x69, 0x72, 0x00, 0x03, 0x70, 0x75, 0x74, 0x00, 0x07, 0x70, 0x77, 0x5f, 0x6e, 0x61, 0x6d, 0x65, 0x00, 0x15,
			0x71, 0x75, 0x65, 0x72, 0x79, 0x49, 0x6e, 0x74, 0x65, 0x6e, 0x74, 0x41, 0x63, 0x74, 0x69, 0x76, 0x69, 0x74, 0x69,
			0x65, 0x73, 0x00, 0x13, 0x71, 0x75, 0x65, 0x72, 0x79, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6d, 0x42, 0x6f, 0x6f, 0x74,
			0x54, 0x69, 0x6d, 0x65, 0x00, 0x04, 0x72, 0x65, 0x61, 0x64, 0x00, 0x09, 0x72, 0x65, 0x61, 0x64, 0x46, 0x75, 0x6c,
			0x6c, 0x79, 0x00, 0x07, 0x72, 0x65, 0x61, 0x64, 0x49, 0x6e, 0x74, 0x00, 0x08, 0x72, 0x65, 0x61, 0x64, 0x6c, 0x69,
			0x6e, 0x6b, 0x00, 0x13, 0x72, 0x65, 0x73, 0x6f, 0x6c, 0x76, 0x65, 0x55, 0x73, 0x65, 0x72, 0x49, 0x64, 0x54, 0x6f,
			0x4e, 0x61, 0x6d, 0x65, 0x00, 0x03, 0x72, 0x75, 0x6e, 0x00, 0x11, 0x73, 0x53, 0x74, 0x61, 0x74, 0x75, 0x73, 0x55,
			0x69, 0x64, 0x50, 0x61, 0x74, 0x74, 0x65, 0x72, 0x6e, 0x00, 0x09, 0x73, 0x65, 0x74, 0x42, 0x6f, 0x75, 0x6e, 0x64,
			0x73, 0x00, 0x0b, 0x73, 0x65, 0x74, 0x54, 0x69, 0x6d, 0x65, 0x5a, 0x6f, 0x6e, 0x65, 0x00, 0x04, 0x73, 0x69, 0x7a,
			0x65, 0x00, 0x04, 0x73, 0x6f, 0x72, 0x74, 0x00, 0x07, 0x73, 0x6f, 0x75, 0x72, 0x63, 0x65, 0x73, 0x00, 0x05, 0x73,
			0x70, 0x6c, 0x69, 0x74, 0x00, 0x15, 0x73, 0x70, 0x6c, 0x69, 0x74, 0x50, 0x75, 0x62, 0x6c, 0x69, 0x63, 0x53, 0x6f,
			0x75, 0x72, 0x63, 0x65, 0x44, 0x69, 0x72, 0x73, 0x00, 0x05, 0x73, 0x74, 0x61, 0x72, 0x74, 0x00, 0x07, 0x73, 0x74,
			0x61, 0x72, 0x74, 0x65, 0x64, 0x00, 0x04, 0x73, 0x74, 0x61, 0x74, 0x00, 0x06, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73,
			0x00, 0x09, 0x73, 0x75, 0x62, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x00, 0x07, 0x73, 0x79, 0x73, 0x63, 0x6f, 0x6e,
			0x66, 0x00, 0x0a, 0x73, 0x79, 0x73, 0x74, 0x65, 0x6d, 0x4d, 0x61, 0x69, 0x6e, 0x00, 0x0a, 0x74, 0x61, 0x72, 0x67,
			0x65, 0x74, 0x2d, 0x73, 0x64, 0x6b, 0x00, 0x10, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x53, 0x64, 0x6b, 0x56, 0x65,
			0x72, 0x73, 0x69, 0x6f, 0x6e, 0x00, 0x06, 0x74, 0x68, 0x69, 0x73, 0x24, 0x30, 0x00, 0x08, 0x74, 0x6f, 0x53, 0x74,
			0x72, 0x69, 0x6e, 0x67, 0x00, 0x0b, 0x74, 0x6f, 0x55, 0x70, 0x70, 0x65, 0x72, 0x43, 0x61, 0x73, 0x65, 0x00, 0x0b,
			0x74, 0x6f, 0x70, 0x41, 0x63, 0x74, 0x69, 0x76, 0x69, 0x74, 0x79, 0x00, 0x04, 0x75, 0x73, 0x65, 0x72, 0x00, 0x0a,
			0x76, 0x61, 0x6c, 0x24, 0x63, 0x6c, 0x69, 0x65, 0x6e, 0x74, 0x00, 0x05, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x00, 0x07,
			0x76, 0x61, 0x6c, 0x75, 0x65, 0x4f, 0x66, 0x00, 0x06, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x73, 0x00, 0x07, 0x76, 0x65,
			0x72, 0x73, 0x69, 0x6f, 0x6e, 0x00, 0x0b, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x43, 0x6f, 0x64, 0x65, 0x00,
			0x0b, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x4e, 0x61, 0x6d, 0x65, 0x00, 0x05, 0x77, 0x72, 0x69, 0x74, 0x65,
			0x00, 0x08, 0x77, 0x72, 0x69, 0x74, 0x65, 0x49, 0x6e, 0x74, 0x00, 0x1c, 0x79, 0x79, 0x79, 0x79, 0x2d, 0x4d, 0x4d,
			0x2d, 0x64, 0x64, 0x27, 0x54, 0x27, 0x48, 0x48, 0x3a, 0x6d, 0x6d, 0x3a, 0x73, 0x73, 0x2e, 0x53, 0x53, 0x53, 0x27,
			0x5a, 0x27, 0x00, 0x8c, 0x01, 0x02, 0x00, 0x00, 0x07, 0x0e, 0x00, 0x8e, 0x01, 0x00, 0x07, 0x0e, 0x5a, 0x00, 0x9e,
			0x01, 0x03, 0x00, 0x00, 0x00, 0x07, 0x0e, 0x00, 0xa0, 0x01, 0x00, 0x07, 0x0e, 0x78, 0x00, 0xd2, 0x04, 0x01, 0x00,
			0x07, 0x0e, 0x00, 0xd5, 0x04, 0x02, 0x00, 0x00, 0x07, 0x0e, 0x00, 0xd2, 0x04, 0x02, 0x00, 0x00, 0x07, 0x0e, 0x00,
			0x6b, 0x00, 0x07, 0x0e, 0x00, 0x77, 0x02, 0x00, 0x00, 0x07, 0x0e, 0x39, 0x4d, 0x69, 0xa7, 0xe3, 0x69, 0x69, 0xb4,
			0xb4, 0xb5, 0x01, 0x16, 0x0f, 0xe5, 0x2d, 0x9a, 0x02, 0x76, 0x1d, 0x1e, 0x02, 0x75, 0x68, 0x00, 0x3d, 0x01, 0x00,
			0x07, 0x0e, 0x00, 0xe9, 0x04, 0x02, 0x00, 0x00, 0x07, 0x1d, 0x01, 0x1c, 0x10, 0xb4, 0x69, 0x3c, 0x88, 0xb4, 0x69,
			0x2d, 0xa7, 0x6a, 0x87, 0x3c, 0x89, 0x96, 0x5a, 0xb7, 0x1a, 0x1e, 0x00, 0xe0, 0x04, 0x01, 0x00, 0x07, 0x0e, 0x0f,
			0x69, 0x3c, 0x5b, 0x00, 0x9b, 0x05, 0x00, 0x07, 0x1d, 0x78, 0x5b, 0x69, 0x69, 0x20, 0x00, 0x93, 0x02, 0x01, 0x00,
			0x07, 0x3b, 0x4b, 0xd4, 0x4b, 0x2d, 0x69, 0x2d, 0x4c, 0xa1, 0x43, 0x4d, 0x5b, 0x4b, 0x97, 0xff, 0x2e, 0x6b, 0x69,
			0x2d, 0x8a, 0x4c, 0x4f, 0x2e, 0x41, 0x87, 0x5d, 0x5a, 0x3c, 0x3c, 0x3c, 0x3d, 0x02, 0x58, 0x59, 0x02, 0x18, 0x1d,
			0x2d, 0x02, 0x78, 0x1d, 0x02, 0x1a, 0x2c, 0x02, 0x4b, 0x1d, 0x00, 0xd7, 0x02, 0x01, 0x00, 0x07, 0x0e, 0x78, 0xf1,
			0x4b, 0x5a, 0x2d, 0x3c, 0xb2, 0x3f, 0x4c, 0x01, 0x11, 0x0f, 0x67, 0x42, 0x8b, 0x30, 0x8a, 0x5b, 0x4c, 0x5a, 0x01,
			0x14, 0x0f, 0xff, 0xa8, 0x5a, 0x01, 0x14, 0x0f, 0x6b, 0x5a, 0x01, 0x14, 0x0f, 0x78, 0x96, 0x69, 0x2d, 0xa1, 0x53,
			0x1e, 0x4b, 0x4b, 0x2d, 0x69, 0x2d, 0xa9, 0xff, 0xb5, 0x6b, 0x2d, 0x02, 0x11, 0x95, 0x1e, 0x4b, 0x5c, 0x01, 0x14,
			0x0f, 0x9a, 0x9a, 0x69, 0x2d, 0x5a, 0x87, 0x3a, 0x02, 0x60, 0x3b, 0xb8, 0x4b, 0x30, 0x02, 0x19, 0x68, 0x5c, 0x69,
			0x5a, 0x96, 0x5c, 0x69, 0x7b, 0x5a, 0x3c, 0x3c, 0x3d, 0x5c, 0x02, 0x60, 0x1d, 0x02, 0x7b, 0x3b, 0x02, 0x6d, 0x2c,
			0x02, 0x41, 0x3b, 0x00, 0xb6, 0x04, 0x01, 0x00, 0x07, 0x1d, 0x6a, 0x4b, 0x4c, 0x69, 0x5a, 0x3c, 0x3d, 0x5a, 0xd3,
			0x00, 0x8f, 0x04, 0x02, 0x00, 0x00, 0x07, 0x0e, 0x5b, 0x98, 0x78, 0xb4, 0x96, 0x78, 0x78, 0x69, 0x6b, 0x4b, 0x5a,
			0x78, 0x5f, 0x19, 0x1e, 0x00, 0xaa, 0x04, 0x01, 0x00, 0x07, 0x0e, 0x5a, 0x5a, 0x2d, 0x2d, 0x69, 0x3a, 0x3f, 0x00,
			0xc7, 0x04, 0x00, 0x07, 0x0e, 0x5b, 0x01, 0x16, 0x0f, 0x96, 0x69, 0x2d, 0x5a, 0x3d, 0x3c, 0x78, 0x02, 0x78, 0x86,
			0x02, 0x12, 0x4a, 0x00, 0xa7, 0x05, 0x01, 0x00, 0x07, 0x0e, 0x5b, 0x5b, 0x4c, 0x4b, 0x41, 0x3e, 0x02, 0x7a, 0x59,
			0x5c, 0x4b, 0x00, 0xe2, 0x01, 0x01, 0x00, 0x07, 0x2c, 0xd3, 0x4b, 0x02, 0x2a, 0x2c, 0x02, 0x5c, 0x1d, 0x7c, 0x6b,
			0xa5, 0x2d, 0x8a, 0x4c, 0x4f, 0x2e, 0x42, 0x5a, 0x3c, 0x3c, 0x3c, 0x02, 0x6f, 0x4a, 0x33, 0x02, 0x69, 0x2c, 0x00,
			0xe7, 0x03, 0x00, 0x07, 0x1d, 0x02, 0x17, 0x59, 0x02, 0x6d, 0x1d, 0x78, 0x78, 0x20, 0x7b, 0x8b, 0x4b, 0x96, 0x02,
			0x7a, 0x1d, 0x1e, 0x00, 0x82, 0x04, 0x00, 0x07, 0x0e, 0x5b, 0x78, 0x5b, 0x01, 0x17, 0x0f, 0x89, 0x00, 0x99, 0x01,
			0x00, 0x07, 0x0e, 0x7b, 0x69, 0x7c, 0x4b, 0x21, 0x00, 0x3f, 0x01, 0x00, 0x07, 0x2c, 0x3c, 0x78, 0x02, 0x23, 0x3b,
			0x02, 0x61, 0x1d, 0x2e, 0x01, 0x21, 0x12, 0x01, 0x18, 0x15, 0x3f, 0x69, 0x01, 0x11, 0x0f, 0x02, 0x0b, 0x01, 0x12,
			0x0e, 0x02, 0x69, 0x95, 0x1e, 0x5a, 0x02, 0x0b, 0x59, 0x1e, 0x96, 0x5b, 0x1e, 0x5a, 0x00, 0x88, 0x05, 0x00, 0x07,
			0x0e, 0xb8, 0xc3, 0x3c, 0x02, 0x7a, 0xd1, 0x1e, 0x00, 0x94, 0x05, 0x01, 0x00, 0x07, 0x0e, 0x01, 0x1a, 0x0f, 0x1e,
			0x67, 0x00, 0x94, 0x01, 0x00, 0x07, 0x0e, 0x5a, 0x3c, 0x00, 0xae, 0x01, 0x01, 0x00, 0x07, 0x0e, 0xe1, 0xe7, 0x4b,
			0x02, 0x25, 0x77, 0x3e, 0x02, 0x5c, 0x1d, 0x2d, 0x3d, 0xa7, 0x5a, 0x87, 0x53, 0x2d, 0x88, 0x4b, 0x3c, 0x4b, 0x02,
			0x72, 0x2c, 0x87, 0x5a, 0x87, 0x60, 0x02, 0x0f, 0xb3, 0x02, 0x79, 0x2c, 0x2a, 0x02, 0x5c, 0x2c, 0x00, 0xbb, 0x05,
			0x00, 0x07, 0x0e, 0x00, 0xbc, 0x05, 0x00, 0x07, 0x0e, 0xa5, 0xa5, 0xa1, 0x00, 0xbb, 0x05, 0x02, 0x00, 0x00, 0x07,
			0x0e, 0x00, 0xbb, 0x05, 0x01, 0x00, 0x07, 0x0e, 0x00, 0xbb, 0x05, 0x00, 0x07, 0x0e, 0x00, 0x02, 0x1b, 0x01, 0xb7,
			0x02, 0x1a, 0x85, 0x02, 0x1c, 0x02, 0x9d, 0x01, 0x04, 0x00, 0x89, 0x02, 0x1e, 0x02, 0x1b, 0x01, 0xb7, 0x02, 0x1a,
			0x95, 0x02, 0x1b, 0x01, 0xb7, 0x02, 0x1a, 0x8f, 0x02, 0x1d, 0x01, 0xb7, 0x02, 0x1c, 0x05, 0x17, 0x59, 0x17, 0x67,
			0x17, 0x0d, 0x17, 0x26, 0x17, 0x10, 0x02, 0x1e, 0x01, 0xb7, 0x02, 0x1c, 0x01, 0x18, 0x4d, 0x02, 0x1d, 0x01, 0xb7,
			0x02, 0x1c, 0x05, 0x17, 0x05, 0x17, 0x6c, 0x17, 0x0d, 0x17, 0x2d, 0x17, 0x10, 0x02, 0x1e, 0x01, 0xb7, 0x02, 0x1c,
			0x01, 0x18, 0x0b, 0x02, 0x1d, 0x01, 0xb7, 0x02, 0x1c, 0x08, 0x17, 0x05, 0x17, 0x6f, 0x17, 0x0d, 0x17, 0x5b, 0x17,
			0x6c, 0x17, 0x0d, 0x17, 0x26, 0x17, 0x11, 0x02, 0x1e, 0x01, 0xb7, 0x02, 0x1c, 0x01, 0x18, 0x27, 0x02, 0x1d, 0x01,
			0xb7, 0x02, 0x1c, 0x04, 0x17, 0x51, 0x17, 0x0d, 0x17, 0x7b, 0x17, 0x10, 0x02, 0x1d, 0x01, 0xb7, 0x02, 0x1c, 0x01,
			0x17, 0x06, 0x00, 0x01, 0x01, 0x01, 0x16, 0x90, 0x20, 0x7d, 0x80, 0x80, 0x04, 0x88, 0x25, 0x7e, 0x01, 0xa4, 0x25,
			0x00, 0x02, 0x01, 0x01, 0x17, 0x90, 0x20, 0x01, 0x90, 0x20, 0x7f, 0x80, 0x80, 0x04, 0xc0, 0x25, 0x80, 0x01, 0x01,
			0xe0, 0x25, 0x00, 0x01, 0x01, 0x02, 0x19, 0x90, 0x20, 0x81, 0x01, 0x80, 0x80, 0x04, 0x80, 0x26, 0x82, 0x01, 0x01,
			0x9c, 0x26, 0x01, 0xc1, 0x20, 0xb8, 0x26, 0x01, 0x0c, 0x15, 0x01, 0x26, 0x0a, 0x1a, 0x12, 0x01, 0x02, 0x01, 0x02,
			0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x02, 0x84,
			0x01, 0x88, 0x80, 0x04, 0xdc, 0x26, 0x01, 0x81, 0x80, 0x04, 0x84, 0x27, 0x01, 0x88, 0x20, 0xc8, 0x29, 0x01, 0x02,
			0xe0, 0x29, 0x01, 0x0a, 0xa0, 0x2c, 0x01, 0x02, 0xe0, 0x2c, 0x01, 0x02, 0xbc, 0x2d, 0x01, 0x02, 0xd0, 0x30, 0x01,
			0x02, 0x80, 0x39, 0x01, 0x02, 0x80, 0x3a, 0x01, 0x0a, 0xdc, 0x3b, 0x01, 0x02, 0xa4, 0x3c, 0x01, 0x0a, 0xcc, 0x3d,
			0x01, 0x02, 0xc0, 0x3e, 0x01, 0x02, 0xb4, 0x40, 0x01, 0x02, 0xc4, 0x41, 0x02, 0x02, 0xb8, 0x42, 0x01, 0x09, 0x88,
			0x43, 0x01, 0x0a, 0x80, 0x46, 0x01, 0x02, 0xf8, 0x46, 0x01, 0x02, 0xe4, 0x47, 0x94, 0x01, 0x04, 0x88, 0x48, 0x04,
			0x00, 0x05, 0x00, 0x27, 0x9a, 0x20, 0x01, 0x99, 0x80, 0x01, 0x01, 0x99, 0x80, 0x01, 0x01, 0x99, 0x80, 0x01, 0x9a,
			0x01, 0x8a, 0x20, 0xec, 0x4a, 0x01, 0x88, 0x80, 0x04, 0xa4, 0x4b, 0x01, 0x82, 0x80, 0x04, 0x80, 0x4c, 0x01, 0x09,
			0x98, 0x4c, 0x01, 0x09, 0xbc, 0x4c, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x02, 0x00,
			0x00, 0x00, 0x5c, 0x00, 0x00, 0x00, 0x70, 0x05, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x00, 0x00, 0xe0,
			0x06, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x00, 0x00, 0x30, 0x0b, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,
			0xa0, 0x00, 0x00, 0x00, 0x88, 0x0c, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x88, 0x11, 0x00,
			0x00, 0x03, 0x10, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x28, 0x12, 0x00, 0x00, 0x01, 0x20, 0x00, 0x00, 0x22, 0x00,
			0x00, 0x00, 0x88, 0x12, 0x00, 0x00, 0x06, 0x20, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x60, 0x26, 0x00, 0x00, 0x01,
			0x10, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x00, 0xf8, 0x26, 0x00, 0x00, 0x02, 0x20, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
			0x72, 0x28, 0x00, 0x00, 0x03, 0x20, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x80, 0x3c, 0x00, 0x00, 0x04, 0x20, 0x00,
			0x00, 0x0c, 0x00, 0x00, 0x00, 0xff, 0x3e, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x8a, 0x3f,
			0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x74, 0x40, 0x00, 0x00
		};

		private class GadgetEntry : Object {
			public signal void detached (SessionDetachReason reason);

			public AgentSessionId local_session_id {
				get;
				construct;
			}

			public HostSession host_session {
				get;
				construct;
			}

			public DBusConnection connection {
				get;
				construct;
			}

			private Promise<bool>? close_request;

			public GadgetEntry (AgentSessionId local_session_id, HostSession host_session, DBusConnection connection) {
				Object (
					local_session_id: local_session_id,
					host_session: host_session,
					connection: connection
				);
			}

			construct {
				connection.on_closed.connect (on_connection_closed);
				host_session.agent_session_detached.connect (on_session_detached);
			}

			~GadgetEntry () {
				connection.on_closed.disconnect (on_connection_closed);
				host_session.agent_session_detached.disconnect (on_session_detached);
			}

			public async void close (Cancellable? cancellable) throws IOError {
				while (close_request != null) {
					try {
						yield close_request.future.wait_async (cancellable);
						return;
					} catch (Error e) {
						assert_not_reached ();
					} catch (IOError e) {
						cancellable.set_error_if_cancelled ();
					}
				}
				close_request = new Promise<bool> ();

				try {
					yield connection.close (cancellable);
				} catch (GLib.Error e) {
					if (e is IOError.CANCELLED) {
						close_request.reject (e);
						close_request = null;

						throw (IOError) e;
					}
				}

				close_request.resolve (true);
			}

			private void on_connection_closed (DBusConnection connection, bool remote_peer_vanished, GLib.Error? error) {
				if (close_request == null) {
					close_request = new Promise<bool> ();
					close_request.resolve (true);
				}

				detached (PROCESS_TERMINATED);
			}

			private void on_session_detached (AgentSessionId id, SessionDetachReason reason) {
				detached (reason);
			}
		}

		private class AgentSessionEntry {
			public AgentSessionId remote_session_id {
				get;
				private set;
			}

			public DBusConnection connection {
				get;
				set;
			}

			public uint sink_registration_id {
				get;
				set;
			}

			public AgentSessionEntry (AgentSessionId remote_session_id, DBusConnection connection) {
				this.remote_session_id = remote_session_id;
				this.connection = connection;
			}

			~AgentSessionEntry () {
				if (sink_registration_id != 0)
					connection.unregister_object (sink_registration_id);
			}
		}

		private class RemoteServer : Object {
			public HostSession session {
				get;
				construct;
			}

			public DBusConnection connection {
				get;
				construct;
			}

			public Flavor flavor {
				get;
				construct;
			}

			public enum Flavor {
				REGULAR,
				GADGET
			}

			public TransportBroker? transport_broker {
				get;
				set;
			}

			public RemoteServer (HostSession session, DBusConnection connection, Flavor flavor,
					TransportBroker? transport_broker) {
				Object (
					session: session,
					connection: connection,
					flavor: flavor,
					transport_broker: transport_broker
				);
			}
		}
	}
}

"""


```